<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        table{
            border: 2px solid black;
            border-collapse: collapse;
        }
        .contenedor{
            display: flex;
            gap: 80px;
            margin: 50px 0px;
        }
    </style>
</head>
<body>
    <div class="contenedor">
        <section>
            <table border="">
                <thead>
                    <tr>
                        <th colspan="2">Invoices pending</th>
                    </tr>
                    <tr>
                        <th>Code</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody id="invoicesPending">
                </tbody>
            </table>
        </section>
        <section>
            <table  border="">
                <thead>
                    <tr>
                        <th colspan="3">Envoice summary</th>
                    </tr>
                    <tr>
                        <th>Cantidad total facturas</th>
                        <th>Cantidad pendiente de cobro</th>
                        <th>Cantidad cobrada</th>

                    </tr>
                </thead>
                <tbody id="invoiceSummary">

                </tbody>
            </table>
        </section>
    </div>

    <button onclick="callToAdd()">Agregar factura</button>
    <button onclick="callToDelete()">Eliminar factura</button>
    <script>

        const facturesPending = new Map();
        //Funcion para validar número
        const checkNumber =  function(msg){
            let dato;
            let repita;
            do {
                repita = false;
                dato = Number(prompt(msg));
                if (isNaN(dato) || dato <= 0) {
                    alert("Cantidad incorrecta, indique un número positivo: ")
                    repita = true;
                }
            } while (repita)
            return dato;
        }

        //Funcion para validar string
            const checkString = function(msg){
            let dato,repita;
            do {
                repita = false;
                dato = prompt(msg)
                if (dato === null){
                    alert("Incorrect code, try again!  ")
                    repita = true;
                }
            } while (repita === true)
            return dato; 
        }
        //actualizar tabla
        const actualizarTable = function(facturesPending,cantFacturas,cantPendiente,cantPagada) {
            let arrayHtmlOne ='', arrayHtmlTwo = '';
            facturesPending.forEach((a,b) => {
                arrayHtmlOne += `<tr><td>${b}</td><td>${a}</td></tr>`
                document.getElementById("invoicesPending").innerHTML = arrayHtmlOne;
            });
            arrayHtmlTwo = `<tr><th>${cantFacturas}</th><th>${cantPendiente}</th><th>${cantPagada}</th></tr>`
            document.getElementById("invoiceSummary").innerHTML = arrayHtmlTwo

        }
        //Funcion para agregar factura
        const addFacture = function(facturesPending) {
            let price, code, cantFacturas = 0, cantPagada = 0, cantPendiente = 0;
            price = checkNumber("What is the envoice price?  ");
            code = checkString("What is the envoice code?  ");
            facturesPending.set(code, price);
            cantPendiente += price;
            cantFacturas++
            actualizarTable(facturesPending,cantFacturas,cantPendiente,cantPagada)
            //document.getElementById("invoicesPending").innerHTML += `<tr><td>${code}</td><td>${price}</td></tr>`;
        }
        //Llamar a la funcion agregar con el button.
        const callToAdd = function() {
            addFacture(facturesPending)
        } 

        const deleteFacture = function(facturesPending) {
            let codeFacture = prompt("Indique el codigo de la factura que quiere eliminar:  ");
            if (facturesPending.has(codeFacture) === true) {
                facturesPending.delete(codeFacture);
                actualizarTable(facturesPending)
            } else {
                alert ("La factura no existe, verifique el codigo. ")
            }
        }
        //Llamar a la funcion eleminar con el button.
        const callToDelete = function() {
            deleteFacture(facturesPending);
        } 
    </script>
</body>
</html>